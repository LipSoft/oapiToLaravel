@extends('master')

@section('content')

<script src="https://cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.1.0/js/dataTables.responsive.min.js"></script>
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.12/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="/css/my_style.css">


<script>
    $( document ).ready(function() {

		var {{{name}}} = [];
		@foreach(${{{capitalizedName}}} as $value)
			{{{name}}}.push( <?php echo json_encode($value);  ?>);		
		@endforeach

		//console.log({{{name}}})

		$('#{{{name}}}').DataTable( {
			data: {{{name}}},
			//fixedHeader: true,
			stateSave: true,
			stateSaveParams: function(settings, data) {
				data.columns.forEach(function(column) {
				delete column.visible;
				});
			},
			order: [[ 0, "asc" ]],
			responsive: {
				details: {
					display: $.fn.dataTable.Responsive.display.childRowImmediate,
					type: ''
				}
			},
			
			lengthMenu: [ [ 10, 25, 50, -1], [ 10, 25, 50, "All"] ],
			columns: [
                {{#fields}}
                { data: "{{{field}}}", title: "{{{desc}}}" },
                {{/fields}}
				{{#belongsTo}}
                { data: "{{{lowerCaseReferencedTableName}}}.{{{summaryProperty}}}", title: "{{{referencedTableName}}}" },
                {{/belongsTo}}
				
				
			], 
			columnDefs: [				
			]
		});

		var table = $('#{{{name}}}').DataTable();
    
		$('#{{{name}}} tbody').on( 'click', 'tr', function () {
			//console.log( table.row( this ).data().id );
			if(table.row( this ).data()){
				document.location.href = '/{{{capitalizedName}}}/' + table.row( this ).data().id;		
			}			
   	 	});

	});

	

</script>

{{Session::get('request_filter_client')}}

<div style="width: 100%; overflow: hidden;margin-top: -10px;">

	<div class="menu" style="width: 150px; float: left;height: calc(100vh - 100px);">
	{{#entities}}			
	@if(strpos(app('request')->route()->getAction()['as'], '{{{name}}}') === 0)
		<a class="selectedMenuLink" href="{{=<% %>=}}{<%={{ }}=%>{{=<% %>=}}{<%={{ }}=%> URL::action('{{{capitalizedName}}}Controller@index') {{=<% %>=}}}<%={{ }}=%>{{=<% %>=}}}<%={{ }}=%>">{{{capitalizedName}}}</a>
	@else
		<a class="menuLink" href="{{=<% %>=}}{<%={{ }}=%>{{=<% %>=}}{<%={{ }}=%> URL::action('{{{capitalizedName}}}Controller@index') {{=<% %>=}}}<%={{ }}=%>{{=<% %>=}}}<%={{ }}=%>">{{{capitalizedName}}}</a>
	@endif	
	</br>
	{{/entities}}			
	</div>
	<div style="margin-left: 160px; float:none;position: absolute; width:calc(100% - 180px);">
	@if(Auth::user()->role_id == 1)
		<form action="{{=<% %>=}}{<%={{ }}=%>{{=<% %>=}}{<%={{ }}=%> URL::action('{{{capitalizedName}}}Controller@create') {{=<% %>=}}}<%={{ }}=%>{{=<% %>=}}}<%={{ }}=%>" method="GET">
			<div class="topButtonDiv"><input class="submitInput" type="submit" value="Criar"></div>
		</form>
	@endif
	
	<table id="{{{name}}}" class="display" width="100%"></table>
</div>
	

@endsection