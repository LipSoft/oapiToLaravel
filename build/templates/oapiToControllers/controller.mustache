<?php

namespace {{{nameSpace}}}\Http\Controllers;

use Illuminate\Http\Request;
use {{{nameSpace}}}\{{{name}}};
{{#belongsTo}}    
use {{{nameSpace}}}\{{{referencedTableName}}};
{{/belongsTo}}
{{#hasMany}}    
use {{{nameSpace}}}\{{{tableName}}};
{{/hasMany}}

class {{{name}}}Controller extends Controller
{

    public function index()
    {      
        return view('{{{lowercaseName}}}.index', [
{{#belongsTo}} 
            '{{{referencedTableName}}}' => {{{referencedTableName}}}::all(),
{{/belongsTo}}
            '{{{name}}}' => {{{name}}}::all()
            {{#belongsTo}}    
            ->with('{{{referencedTableName}}}')
            {{/belongsTo}}
            {{#hasMany}}           
            //->with('{{{tableName}}}')
            {{/hasMany}}
         ]);       
    }

    public function create()
    {
        return view('{{{lowercaseName}}}.create', [
{{#belongsTo}} 
            '{{{referencedTableName}}}' => {{{referencedTableName}}}::all(),
{{/belongsTo}}
{{#hasMany}}   
            //'{{{tableName}}}' => {{{tableName}}}::all(),
{{/hasMany}}
        ]);
    }

    public function show($id)
    {
        return view('{{{lowercaseName}}}.show', [
{{#belongsTo}} 
            '{{{referencedTableName}}}' => {{{referencedTableName}}}::all(),
{{/belongsTo}}
            '{{{name}}}' => {{{name}}}::find($id)
            {{#belongsTo}}    
            ->with('{{{referencedTableName}}}')
            {{/belongsTo}}
            {{#hasMany}}           
            //->with('{{{tableName}}}')
            {{/hasMany}}
         ]);
    }

    public function edit($id)
    {
        return view('{{{lowercaseName}}}.edit', [
{{#belongsTo}} 
            '{{{referencedTableName}}}' => {{{referencedTableName}}}::all(),
{{/belongsTo}}
            '{{{name}}}' => {{{name}}}::find($id)
            {{#belongsTo}}    
            ->with('{{{referencedTableName}}}')
            {{/belongsTo}}
            {{#hasMany}}           
            //->with('{{{tableName}}}')
            {{/hasMany}}
         ]);
    }

    public function store(Request $request)
    {              
        ${{{name}}} = new {{{name}}};
        {{#fields}}
        if (isset($request->{{{field}}})) ${{{name}}}->{{{field}}} = $request->{{{field}}};                        
        {{/fields}}
        
        ${{{name}}}->save();
        return view('{{{lowercaseName}}}.show', [
{{#belongsTo}} 
            '{{{referencedTableName}}}' => {{{referencedTableName}}}::all(),
{{/belongsTo}}
            '{{{name}}}' => {{{name}}}::find(${{{name}}}->{{{pk}}})
            {{#belongsTo}}    
            ->with('{{{referencedTableName}}}')
            {{/belongsTo}}
            {{#hasMany}}           
            //->with('{{{tableName}}}')
            {{/hasMany}}
         ]);
    }
    
    public function update(Request $request, $id)
    {
        ${{{name}}} = {{{name}}}::find($id);
        {{#fields}}
        if (isset($request->{{{field}}})) ${{{name}}}->{{{field}}} = $request->{{{field}}};                              
        {{/fields}}
        
        ${{{name}}}->save();
        return ${{{name}}};
    }

    public function destroy($id)
    {
        return {{{name}}}::destroy($id);
    }
}
