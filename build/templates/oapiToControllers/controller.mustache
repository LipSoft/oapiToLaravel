<?php

namespace {{{nameSpace}}}\Http\Controllers;

use Illuminate\Http\Request;
use {{{nameSpace}}}\{{{name}}};
{{#belongsTo}}    
use {{{nameSpace}}}\{{{referencedTableName}}};
{{/belongsTo}}
{{#hasMany}}    
use {{{nameSpace}}}\{{{tableName}}};
{{/hasMany}}

class {{{name}}}Controller extends Controller
{

    public function index()
    {     
        ${{{name}}} = new {{{name}}};
        return view('{{{lowercaseName}}}.index', [
            {{#belongsTo}} 
            '{{{referencedTableName}}}' => {{{referencedTableName}}}::all(),
            {{/belongsTo}}
            '{{{name}}}' => ${{{name}}}
            {{#belongsTo}}    
            ->With('{{{referencedTableName}}}')
            {{/belongsTo}}
            {{#hasMany}}           
            //->with('{{{tableName}}}')
            {{/hasMany}}
            ->get()
         ]);                
    }

    public function create()
    {
        return view('{{{lowercaseName}}}.create', [
        {{#belongsTo}} 
            '{{{referencedTableName}}}' => {{{referencedTableName}}}::all(),
        {{/belongsTo}}
        ]);
    }

    public function show($id)
    {
        return view('{{{lowercaseName}}}.show', [
            '{{{name}}}' => {{{name}}}::find($id)
        ]);
    }

    public function edit($id)
    {
        return view('{{{lowercaseName}}}.edit', [
            {{#belongsTo}} 
            '{{{referencedTableName}}}' => {{{referencedTableName}}}::all(),
            {{/belongsTo}}
            '{{{name}}}' => {{{name}}}::find($id)
         ]);
    }

    public function store(Request $request)
    {              
        ${{{name}}} = new {{{name}}};
        {{#fields}}
        if (isset($request->{{{field}}})) ${{{name}}}->{{{field}}} = $request->{{{field}}};                        
        {{/fields}}

        {{#belongsTo}}
        if (isset($request->{{{columnName}}})) ${{{tableName}}}->{{{referencedTableName}}}()->associate({{{referencedTableName}}}::find($request->{{{columnName}}}));                       
        {{/belongsTo}}
        
        ${{{name}}}->save();
        
         return view('{{{lowercaseName}}}.show', [
            '{{{name}}}' => {{{name}}}::find(${{{name}}}->{{{pk}}})
         ]);
    }
    
    public function update(Request $request, $id)
    {
        ${{{name}}} = {{{name}}}::findOrFail($id);
        {{#fields}}
        if (isset($request->{{{field}}})) ${{{name}}}->{{{field}}} = $request->{{{field}}};                              
        {{/fields}}

        {{#belongsTo}}
        if (isset($request->{{{columnName}}})) ${{{tableName}}}->{{{referencedTableName}}}()->associate({{{referencedTableName}}}::find($request->{{{columnName}}}));                       
        {{/belongsTo}}
        
        ${{{name}}}->save();
        return view('{{{lowercaseName}}}.show', [
            '{{{name}}}' => ${{{name}}}
        ]);
    }

    public function destroy($id)
    {
        {{{name}}}::destroy($id);
        return view('{{{lowercaseName}}}.index', [
            '{{{name}}}' => {{{name}}}::all()
        ]); 
    }
}
